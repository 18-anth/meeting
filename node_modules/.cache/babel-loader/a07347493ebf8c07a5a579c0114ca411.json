{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\antho\\\\Desktop\\\\codigo reciclable\\\\prueba\\\\src\\\\components\\\\pages\\\\screens\\\\Video.js\";\nimport React, { Component } from 'react';\nimport io from 'socket.io-client';\nimport faker from \"faker\";\nimport { IconButton, Badge, Input, Button } from '@material-ui/core';\nimport VideocamIcon from '@material-ui/icons/Videocam';\nimport VideocamOffIcon from '@material-ui/icons/VideocamOff';\nimport MicIcon from '@material-ui/icons/Mic';\nimport MicOffIcon from '@material-ui/icons/MicOff';\nimport ScreenShareIcon from '@material-ui/icons/ScreenShare';\nimport StopScreenShareIcon from '@material-ui/icons/StopScreenShare';\nimport CallEndIcon from '@material-ui/icons/CallEnd';\nimport ChatIcon from '@material-ui/icons/Chat';\nimport { message } from 'antd';\nimport 'antd/dist/antd.css';\nimport { Row } from 'reactstrap';\nimport Modal from 'react-bootstrap/Modal';\nimport 'bootstrap/dist/css/bootstrap.css';\nimport \"./Video.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst server_url = process.env.NODE_ENV === 'production' ? 'https://video.sebastienbiollo.com' : \"http://localhost:4001\";\nvar connections = {};\nconst peerConnectionConfig = {\n  'iceServers': [// { 'urls': 'stun:stun.services.mozilla.com' },\n  {\n    'urls': 'stun:stun.l.google.com:19302'\n  }]\n};\nvar socket = null;\nvar socketId = null;\nvar elms = 0;\n\nclass Video extends Component {\n  constructor(props) {\n    super(props);\n\n    this.getPermissions = async () => {\n      try {\n        await navigator.mediaDevices.getUserMedia({\n          video: true\n        }).then(() => this.videoAvailable = true).catch(() => this.videoAvailable = false);\n        await navigator.mediaDevices.getUserMedia({\n          audio: true\n        }).then(() => this.audioAvailable = true).catch(() => this.audioAvailable = false);\n\n        if (navigator.mediaDevices.getDisplayMedia) {\n          this.setState({\n            screenAvailable: true\n          });\n        } else {\n          this.setState({\n            screenAvailable: false\n          });\n        }\n\n        if (this.videoAvailable || this.audioAvailable) {\n          navigator.mediaDevices.getUserMedia({\n            video: this.videoAvailable,\n            audio: this.audioAvailable\n          }).then(stream => {\n            window.localStream = stream;\n            this.localVideoref.current.srcObject = stream;\n          }).then(stream => {}).catch(e => console.log(e));\n        }\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    this.getMedia = () => {\n      this.setState({\n        video: this.videoAvailable,\n        audio: this.audioAvailable\n      }, () => {\n        this.getUserMedia();\n        this.connectToSocketServer();\n      });\n    };\n\n    this.getUserMedia = () => {\n      if (this.state.video && this.videoAvailable || this.state.audio && this.audioAvailable) {\n        navigator.mediaDevices.getUserMedia({\n          video: this.state.video,\n          audio: this.state.audio\n        }).then(this.getUserMediaSuccess).then(stream => {}).catch(e => console.log(e));\n      } else {\n        try {\n          let tracks = this.localVideoref.current.srcObject.getTracks();\n          tracks.forEach(track => track.stop());\n        } catch (e) {}\n      }\n    };\n\n    this.getUserMediaSuccess = stream => {\n      try {\n        window.localStream.getTracks().forEach(track => track.stop());\n      } catch (e) {\n        console.log(e);\n      }\n\n      window.localStream = stream;\n      this.localVideoref.current.srcObject = stream;\n\n      for (let id in connections) {\n        if (id === socketId) continue;\n        connections[id].addStream(window.localStream); // eslint-disable-next-line no-loop-func\n\n        connections[id].createOffer().then(description => {\n          connections[id].setLocalDescription(description).then(() => {\n            socket.emit('signal', id, JSON.stringify({\n              'sdp': connections[id].localDescription\n            }));\n          }).catch(e => console.log(e));\n        });\n      }\n\n      stream.getTracks().forEach(track => track.onended = () => {\n        this.setState({\n          video: false,\n          audio: false\n        }, () => {\n          try {\n            let tracks = this.localVideoref.current.srcObject.getTracks();\n            tracks.forEach(track => track.stop());\n          } catch (e) {\n            console.log(e);\n          }\n\n          let blackSilence = (...args) => new MediaStream([this.black(...args), this.silence()]);\n\n          window.localStream = blackSilence();\n          this.localVideoref.current.srcObject = window.localStream;\n\n          for (let id in connections) {\n            connections[id].addStream(window.localStream); // eslint-disable-next-line no-loop-func\n\n            connections[id].createOffer().then(description => {\n              connections[id].setLocalDescription(description).then(() => {\n                socket.emit('signal', id, JSON.stringify({\n                  'sdp': connections[id].localDescription\n                }));\n              }).catch(e => console.log(e));\n            });\n          }\n        });\n      });\n    };\n\n    this.getDislayMedia = () => {\n      if (this.state.screen) {\n        if (navigator.mediaDevices.getDisplayMedia) {\n          navigator.mediaDevices.getDisplayMedia({\n            video: true,\n            audio: true\n          }).then(this.getDislayMediaSuccess).then(stream => {}).catch(e => console.log(e));\n        }\n      }\n    };\n\n    this.getDislayMediaSuccess = stream => {\n      try {\n        window.localStream.getTracks().forEach(track => track.stop());\n      } catch (e) {\n        console.log(e);\n      }\n\n      window.localStream = stream;\n      this.localVideoref.current.srcObject = stream;\n\n      for (let id in connections) {\n        if (id === socketId) continue;\n        connections[id].addStream(window.localStream); // eslint-disable-next-line no-loop-func\n\n        connections[id].createOffer().then(description => {\n          connections[id].setLocalDescription(description).then(() => {\n            socket.emit('signal', id, JSON.stringify({\n              'sdp': connections[id].localDescription\n            }));\n          }).catch(e => console.log(e));\n        });\n      }\n\n      stream.getTracks().forEach(track => track.onended = () => {\n        this.setState({\n          screen: false\n        }, () => {\n          try {\n            let tracks = this.localVideoref.current.srcObject.getTracks();\n            tracks.forEach(track => track.stop());\n          } catch (e) {\n            console.log(e);\n          }\n\n          let blackSilence = (...args) => new MediaStream([this.black(...args), this.silence()]);\n\n          window.localStream = blackSilence();\n          this.localVideoref.current.srcObject = window.localStream;\n          this.getUserMedia();\n        });\n      });\n    };\n\n    this.gotMessageFromServer = (fromId, message) => {\n      var signal = JSON.parse(message);\n\n      if (fromId !== socketId) {\n        if (signal.sdp) {\n          connections[fromId].setRemoteDescription(new RTCSessionDescription(signal.sdp)).then(() => {\n            if (signal.sdp.type === 'offer') {\n              connections[fromId].createAnswer().then(description => {\n                connections[fromId].setLocalDescription(description).then(() => {\n                  socket.emit('signal', fromId, JSON.stringify({\n                    'sdp': connections[fromId].localDescription\n                  }));\n                }).catch(e => console.log(e));\n              }).catch(e => console.log(e));\n            }\n          }).catch(e => console.log(e));\n        }\n\n        if (signal.ice) {\n          connections[fromId].addIceCandidate(new RTCIceCandidate(signal.ice)).catch(e => console.log(e));\n        }\n      }\n    };\n\n    this.changeCssVideos = main => {\n      let widthMain = main.offsetWidth;\n      let minWidth = \"30%\";\n\n      if (widthMain * 30 / 100 < 300) {\n        minWidth = \"300px\";\n      }\n\n      let minHeight = \"40%\";\n      let height = String(100 / elms) + \"%\";\n      let width = \"\";\n\n      if (elms === 0 || elms === 1) {\n        width = \"100%\";\n        height = \"100%\";\n      } else if (elms === 2) {\n        width = \"45%\";\n        height = \"100%\";\n      } else if (elms === 3 || elms === 4) {\n        width = \"35%\";\n        height = \"50%\";\n      } else {\n        width = String(100 / elms) + \"%\";\n      }\n\n      let videos = main.querySelectorAll(\"video\");\n\n      for (let a = 0; a < videos.length; ++a) {\n        videos[a].style.minWidth = minWidth;\n        videos[a].style.minHeight = minHeight;\n        videos[a].style.setProperty(\"width\", width);\n        videos[a].style.setProperty(\"height\", height);\n      }\n\n      return {\n        minWidth,\n        minHeight,\n        width,\n        height\n      };\n    };\n\n    this.connectToSocketServer = () => {\n      socket = io.connect(server_url, {\n        secure: true\n      });\n      socket.on('signal', this.gotMessageFromServer);\n      socket.on('connect', () => {\n        socket.emit('join-call', window.location.href);\n        socketId = socket.id;\n        socket.on('chat-message', this.addMessage);\n        socket.on('user-left', id => {\n          let video = document.querySelector(`[data-socket=\"${id}\"]`);\n\n          if (video !== null) {\n            elms--;\n            video.parentNode.removeChild(video);\n            let main = document.getElementById('main');\n            this.changeCssVideos(main);\n          }\n        });\n        socket.on('user-joined', (id, clients) => {\n          clients.forEach(socketListId => {\n            connections[socketListId] = new RTCPeerConnection(peerConnectionConfig); // Wait for their ice candidate       \n\n            connections[socketListId].onicecandidate = function (event) {\n              if (event.candidate != null) {\n                socket.emit('signal', socketListId, JSON.stringify({\n                  'ice': event.candidate\n                }));\n              }\n            }; // Wait for their video stream\n\n\n            connections[socketListId].onaddstream = event => {\n              // TODO mute button, full screen button\n              var searchVidep = document.querySelector(`[data-socket=\"${socketListId}\"]`);\n\n              if (searchVidep !== null) {\n                // if i don't do this check it make an empyt square\n                searchVidep.srcObject = event.stream;\n              } else {\n                elms = clients.length;\n                let main = document.getElementById('main');\n                let cssMesure = this.changeCssVideos(main);\n                let video = document.createElement('video');\n                let css = {\n                  minWidth: cssMesure.minWidth,\n                  minHeight: cssMesure.minHeight,\n                  maxHeight: \"100%\",\n                  margin: \"10px\",\n                  borderStyle: \"solid\",\n                  borderColor: \"#bdbdbd\",\n                  objectFit: \"fill\"\n                };\n\n                for (let i in css) video.style[i] = css[i];\n\n                video.style.setProperty(\"width\", cssMesure.width);\n                video.style.setProperty(\"height\", cssMesure.height);\n                video.setAttribute('data-socket', socketListId);\n                video.srcObject = event.stream;\n                video.autoplay = true;\n                video.playsinline = true;\n                main.appendChild(video);\n              }\n            }; // Add the local video stream\n\n\n            if (window.localStream !== undefined && window.localStream !== null) {\n              connections[socketListId].addStream(window.localStream);\n            } else {\n              let blackSilence = (...args) => new MediaStream([this.black(...args), this.silence()]);\n\n              window.localStream = blackSilence();\n              connections[socketListId].addStream(window.localStream);\n            }\n          });\n\n          if (id === socketId) {\n            for (let id2 in connections) {\n              if (id2 === socketId) continue;\n\n              try {\n                connections[id2].addStream(window.localStream);\n              } catch (e) {} // eslint-disable-next-line no-loop-func\n\n\n              connections[id2].createOffer().then(description => {\n                connections[id2].setLocalDescription(description).then(() => {\n                  socket.emit('signal', id2, JSON.stringify({\n                    'sdp': connections[id2].localDescription\n                  }));\n                }).catch(e => console.log(e));\n              });\n            }\n          }\n        });\n      });\n    };\n\n    this.silence = () => {\n      let ctx = new AudioContext();\n      let oscillator = ctx.createOscillator();\n      let dst = oscillator.connect(ctx.createMediaStreamDestination());\n      oscillator.start();\n      ctx.resume();\n      return Object.assign(dst.stream.getAudioTracks()[0], {\n        enabled: false\n      });\n    };\n\n    this.black = ({\n      width = 640,\n      height = 480\n    } = {}) => {\n      let canvas = Object.assign(document.createElement(\"canvas\"), {\n        width,\n        height\n      });\n      canvas.getContext('2d').fillRect(0, 0, width, height);\n      let stream = canvas.captureStream();\n      return Object.assign(stream.getVideoTracks()[0], {\n        enabled: false\n      });\n    };\n\n    this.handleVideo = () => this.setState({\n      video: !this.state.video\n    }, () => this.getUserMedia());\n\n    this.handleAudio = () => this.setState({\n      audio: !this.state.audio\n    }, () => this.getUserMedia());\n\n    this.handleScreen = () => this.setState({\n      screen: !this.state.screen\n    }, () => this.getDislayMedia());\n\n    this.handleEndCall = () => {\n      try {\n        let tracks = this.localVideoref.current.srcObject.getTracks();\n        tracks.forEach(track => track.stop());\n      } catch (e) {}\n\n      window.location.href = \"/\";\n    };\n\n    this.openChat = () => this.setState({\n      showModal: true,\n      newmessages: 0\n    });\n\n    this.closeChat = () => this.setState({\n      showModal: false\n    });\n\n    this.handleMessage = e => this.setState({\n      message: e.target.value\n    });\n\n    this.addMessage = (data, sender, socketIdSender) => {\n      this.setState(prevState => ({\n        messages: [...prevState.messages, {\n          \"sender\": sender,\n          \"data\": data\n        }]\n      }));\n\n      if (socketIdSender !== socketId) {\n        this.setState({\n          newmessages: this.state.newmessages + 1\n        });\n      }\n    };\n\n    this.handleUsername = e => this.setState({\n      username: e.target.value\n    });\n\n    this.sendMessage = () => {\n      socket.emit('chat-message', this.state.message, this.state.username);\n      this.setState({\n        message: \"\",\n        sender: this.state.username\n      });\n    };\n\n    this.copyUrl = () => {\n      let text = window.location.href;\n\n      if (!navigator.clipboard) {\n        let textArea = document.createElement(\"textarea\");\n        textArea.value = text;\n        document.body.appendChild(textArea);\n        textArea.focus();\n        textArea.select();\n\n        try {\n          document.execCommand('copy');\n          message.success(\"Link copied to clipboard!\");\n        } catch (err) {\n          message.error(\"Failed to copy\");\n        }\n\n        document.body.removeChild(textArea);\n        return;\n      }\n\n      navigator.clipboard.writeText(text).then(function () {\n        message.success(\"Link copied to clipboard!\");\n      }, () => {\n        message.error(\"Failed to copy\");\n      });\n    };\n\n    this.connect = () => this.setState({\n      askForUsername: false\n    }, () => this.getMedia());\n\n    this.isChrome = function () {\n      let userAgent = (navigator && (navigator.userAgent || '')).toLowerCase();\n      let vendor = (navigator && (navigator.vendor || '')).toLowerCase();\n      let matchChrome = /google inc/.test(vendor) ? userAgent.match(/(?:chrome|crios)\\/(\\d+)/) : null; // let matchFirefox = userAgent.match(/(?:firefox|fxios)\\/(\\d+)/)\n      // return matchChrome !== null || matchFirefox !== null\n\n      return matchChrome !== null;\n    };\n\n    this.localVideoref = /*#__PURE__*/React.createRef();\n    this.videoAvailable = false;\n    this.audioAvailable = false;\n    this.state = {\n      video: false,\n      audio: false,\n      screen: false,\n      showModal: false,\n      screenAvailable: false,\n      messages: [],\n      message: \"\",\n      newmessages: 0,\n      askForUsername: true,\n      username: faker.internet.userName()\n    };\n    connections = {};\n    this.getPermissions();\n  }\n\n  render() {\n    if (this.isChrome() === false) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          background: \"white\",\n          width: \"30%\",\n          height: \"auto\",\n          padding: \"20px\",\n          minWidth: \"400px\",\n          textAlign: \"center\",\n          margin: \"auto\",\n          marginTop: \"50px\",\n          justifyContent: \"center\"\n        },\n        children: /*#__PURE__*/_jsxDEV(\"h1\", {\n          children: \"Sorry, this works only with Google Chrome\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 454,\n          columnNumber: 6\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 452,\n        columnNumber: 5\n      }, this);\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: this.state.askForUsername === true ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            background: \"white\",\n            width: \"30%\",\n            height: \"auto\",\n            padding: \"20px\",\n            minWidth: \"400px\",\n            textAlign: \"center\",\n            margin: \"auto\",\n            marginTop: \"50px\",\n            justifyContent: \"center\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            style: {\n              margin: 0,\n              fontWeight: \"bold\",\n              paddingRight: \"50px\"\n            },\n            children: \"Set your username\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 464,\n            columnNumber: 8\n          }, this), /*#__PURE__*/_jsxDEV(Input, {\n            placeholder: \"Username\",\n            value: this.state.username,\n            onChange: e => this.handleUsername(e)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 465,\n            columnNumber: 8\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"contained\",\n            color: \"primary\",\n            onClick: this.connect,\n            style: {\n              margin: \"20px\"\n            },\n            children: \"Connect\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 466,\n            columnNumber: 8\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 462,\n          columnNumber: 7\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            justifyContent: \"center\",\n            textAlign: \"center\",\n            paddingTop: \"40px\",\n            alignItems: 'center'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"video\", {\n            id: \"my-video\",\n            ref: this.localVideoref,\n            autoPlay: true,\n            muted: true,\n            style: {\n              borderStyle: \"solid\",\n              borderColor: \"#bdbdbd\",\n              objectFit: \"fill\",\n              width: \"30%\",\n              height: \"30%\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 470,\n            columnNumber: 8\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 469,\n          columnNumber: 7\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 461,\n        columnNumber: 6\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"btn-down\",\n          style: {\n            backgroundColor: \"whitesmoke\",\n            color: \"whitesmoke\",\n            textAlign: \"center\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(IconButton, {\n            style: {\n              color: \"#424242\"\n            },\n            onClick: this.handleVideo,\n            children: this.state.video === true ? /*#__PURE__*/_jsxDEV(VideocamIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 478,\n              columnNumber: 40\n            }, this) : /*#__PURE__*/_jsxDEV(VideocamOffIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 478,\n              columnNumber: 59\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 477,\n            columnNumber: 8\n          }, this), /*#__PURE__*/_jsxDEV(IconButton, {\n            style: {\n              color: \"#f44336\"\n            },\n            onClick: this.handleEndCall,\n            children: /*#__PURE__*/_jsxDEV(CallEndIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 482,\n              columnNumber: 9\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 481,\n            columnNumber: 8\n          }, this), /*#__PURE__*/_jsxDEV(IconButton, {\n            style: {\n              color: \"#424242\"\n            },\n            onClick: this.handleAudio,\n            children: this.state.audio === true ? /*#__PURE__*/_jsxDEV(MicIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 486,\n              columnNumber: 38\n            }, this) : /*#__PURE__*/_jsxDEV(MicOffIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 486,\n              columnNumber: 52\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 485,\n            columnNumber: 8\n          }, this), this.state.screenAvailable === true ? /*#__PURE__*/_jsxDEV(IconButton, {\n            style: {\n              color: \"#424242\"\n            },\n            onClick: this.handleScreen,\n            children: this.state.screen === true ? /*#__PURE__*/_jsxDEV(ScreenShareIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 491,\n              columnNumber: 40\n            }, this) : /*#__PURE__*/_jsxDEV(StopScreenShareIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 491,\n              columnNumber: 62\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 490,\n            columnNumber: 9\n          }, this) : null, /*#__PURE__*/_jsxDEV(Badge, {\n            badgeContent: this.state.newmessages,\n            max: 999,\n            color: \"secondary\",\n            onClick: this.openChat,\n            children: /*#__PURE__*/_jsxDEV(IconButton, {\n              style: {\n                color: \"#424242\"\n              },\n              onClick: this.openChat,\n              children: /*#__PURE__*/_jsxDEV(ChatIcon, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 497,\n                columnNumber: 10\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 496,\n              columnNumber: 9\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 495,\n            columnNumber: 8\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 476,\n          columnNumber: 7\n        }, this), /*#__PURE__*/_jsxDEV(Modal, {\n          show: this.state.showModal,\n          onHide: this.closeChat,\n          style: {\n            zIndex: \"999999\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n            closeButton: true,\n            children: /*#__PURE__*/_jsxDEV(Modal.Title, {\n              children: \"Chat Room\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 504,\n              columnNumber: 9\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 503,\n            columnNumber: 8\n          }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n            style: {\n              overflow: \"auto\",\n              overflowY: \"auto\",\n              height: \"400px\",\n              textAlign: \"left\"\n            },\n            children: this.state.messages.length > 0 ? this.state.messages.map((item, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                textAlign: \"left\"\n              },\n              children: /*#__PURE__*/_jsxDEV(\"p\", {\n                style: {\n                  wordBreak: \"break-all\"\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                  children: item.sender\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 509,\n                  columnNumber: 49\n                }, this), \": \", item.data]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 509,\n                columnNumber: 11\n              }, this)\n            }, index, false, {\n              fileName: _jsxFileName,\n              lineNumber: 508,\n              columnNumber: 10\n            }, this)) : /*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"No message yet\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 511,\n              columnNumber: 14\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 506,\n            columnNumber: 8\n          }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {\n            className: \"div-send-msg\",\n            children: [/*#__PURE__*/_jsxDEV(Input, {\n              placeholder: \"Message\",\n              value: this.state.message,\n              onChange: e => this.handleMessage(e)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 514,\n              columnNumber: 9\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              color: \"primary\",\n              onClick: this.sendMessage,\n              children: \"Send\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 515,\n              columnNumber: 9\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 513,\n            columnNumber: 8\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 502,\n          columnNumber: 7\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"container\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              paddingTop: \"20px\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(Input, {\n              value: window.location.href,\n              disable: \"true\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 521,\n              columnNumber: 9\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              style: {\n                backgroundColor: \"#3f51b5\",\n                color: \"whitesmoke\",\n                marginLeft: \"20px\",\n                marginTop: \"10px\",\n                width: \"120px\",\n                fontSize: \"10px\"\n              },\n              onClick: this.copyUrl,\n              children: \"Copy invite link\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 522,\n              columnNumber: 9\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 520,\n            columnNumber: 8\n          }, this), /*#__PURE__*/_jsxDEV(Row, {\n            id: \"main\",\n            className: \"flex-container\",\n            style: {\n              margin: 0,\n              padding: 0\n            },\n            children: /*#__PURE__*/_jsxDEV(\"video\", {\n              id: \"my-video\",\n              ref: this.localVideoref,\n              autoPlay: true,\n              muted: true,\n              style: {\n                borderStyle: \"solid\",\n                borderColor: \"#bdbdbd\",\n                margin: \"10px\",\n                objectFit: \"fill\",\n                width: \"50%\",\n                height: \"50%\"\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 528,\n              columnNumber: 9\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 527,\n            columnNumber: 8\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 519,\n          columnNumber: 7\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 475,\n        columnNumber: 6\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 459,\n      columnNumber: 4\n    }, this);\n  }\n\n}\n\nexport default Video;","map":{"version":3,"sources":["C:/Users/antho/Desktop/codigo reciclable/prueba/src/components/pages/screens/Video.js"],"names":["React","Component","io","faker","IconButton","Badge","Input","Button","VideocamIcon","VideocamOffIcon","MicIcon","MicOffIcon","ScreenShareIcon","StopScreenShareIcon","CallEndIcon","ChatIcon","message","Row","Modal","server_url","process","env","NODE_ENV","connections","peerConnectionConfig","socket","socketId","elms","Video","constructor","props","getPermissions","navigator","mediaDevices","getUserMedia","video","then","videoAvailable","catch","audio","audioAvailable","getDisplayMedia","setState","screenAvailable","stream","window","localStream","localVideoref","current","srcObject","e","console","log","getMedia","connectToSocketServer","state","getUserMediaSuccess","tracks","getTracks","forEach","track","stop","id","addStream","createOffer","description","setLocalDescription","emit","JSON","stringify","localDescription","onended","blackSilence","args","MediaStream","black","silence","getDislayMedia","screen","getDislayMediaSuccess","gotMessageFromServer","fromId","signal","parse","sdp","setRemoteDescription","RTCSessionDescription","type","createAnswer","ice","addIceCandidate","RTCIceCandidate","changeCssVideos","main","widthMain","offsetWidth","minWidth","minHeight","height","String","width","videos","querySelectorAll","a","length","style","setProperty","connect","secure","on","location","href","addMessage","document","querySelector","parentNode","removeChild","getElementById","clients","socketListId","RTCPeerConnection","onicecandidate","event","candidate","onaddstream","searchVidep","cssMesure","createElement","css","maxHeight","margin","borderStyle","borderColor","objectFit","i","setAttribute","autoplay","playsinline","appendChild","undefined","id2","ctx","AudioContext","oscillator","createOscillator","dst","createMediaStreamDestination","start","resume","Object","assign","getAudioTracks","enabled","canvas","getContext","fillRect","captureStream","getVideoTracks","handleVideo","handleAudio","handleScreen","handleEndCall","openChat","showModal","newmessages","closeChat","handleMessage","target","value","data","sender","socketIdSender","prevState","messages","handleUsername","username","sendMessage","copyUrl","text","clipboard","textArea","body","focus","select","execCommand","success","err","error","writeText","askForUsername","isChrome","userAgent","toLowerCase","vendor","matchChrome","test","match","createRef","internet","userName","render","background","padding","textAlign","marginTop","justifyContent","fontWeight","paddingRight","paddingTop","alignItems","backgroundColor","color","zIndex","overflow","overflowY","map","item","index","wordBreak","marginLeft","fontSize"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport io from 'socket.io-client'\r\nimport faker from \"faker\"\r\n\r\nimport {IconButton, Badge, Input, Button} from '@material-ui/core'\r\nimport VideocamIcon from '@material-ui/icons/Videocam'\r\nimport VideocamOffIcon from '@material-ui/icons/VideocamOff'\r\nimport MicIcon from '@material-ui/icons/Mic'\r\nimport MicOffIcon from '@material-ui/icons/MicOff'\r\nimport ScreenShareIcon from '@material-ui/icons/ScreenShare'\r\nimport StopScreenShareIcon from '@material-ui/icons/StopScreenShare'\r\nimport CallEndIcon from '@material-ui/icons/CallEnd'\r\nimport ChatIcon from '@material-ui/icons/Chat'\r\n\r\nimport { message } from 'antd'\r\nimport 'antd/dist/antd.css'\r\n\r\nimport { Row } from 'reactstrap'\r\nimport Modal from 'react-bootstrap/Modal'\r\nimport 'bootstrap/dist/css/bootstrap.css'\r\nimport \"./Video.css\"\r\n\r\nconst server_url = process.env.NODE_ENV === 'production' ? 'https://video.sebastienbiollo.com' : \"http://localhost:4001\"\r\n\r\nvar connections = {}\r\nconst peerConnectionConfig = {\r\n\t'iceServers': [\r\n\t\t// { 'urls': 'stun:stun.services.mozilla.com' },\r\n\t\t{ 'urls': 'stun:stun.l.google.com:19302' },\r\n\t]\r\n}\r\nvar socket = null\r\nvar socketId = null\r\nvar elms = 0\r\n\r\nclass Video extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props)\r\n\r\n\t\tthis.localVideoref = React.createRef()\r\n\r\n\t\tthis.videoAvailable = false\r\n\t\tthis.audioAvailable = false\r\n\r\n\t\tthis.state = {\r\n\t\t\tvideo: false,\r\n\t\t\taudio: false,\r\n\t\t\tscreen: false,\r\n\t\t\tshowModal: false,\r\n\t\t\tscreenAvailable: false,\r\n\t\t\tmessages: [],\r\n\t\t\tmessage: \"\",\r\n\t\t\tnewmessages: 0,\r\n\t\t\taskForUsername: true,\r\n\t\t\tusername: faker.internet.userName(),\r\n\t\t}\r\n\t\tconnections = {}\r\n\r\n\t\tthis.getPermissions()\r\n\t}\r\n\r\n\tgetPermissions = async () => {\r\n\t\ttry{\r\n\t\t\tawait navigator.mediaDevices.getUserMedia({ video: true })\r\n\t\t\t\t.then(() => this.videoAvailable = true)\r\n\t\t\t\t.catch(() => this.videoAvailable = false)\r\n\r\n\t\t\tawait navigator.mediaDevices.getUserMedia({ audio: true })\r\n\t\t\t\t.then(() => this.audioAvailable = true)\r\n\t\t\t\t.catch(() => this.audioAvailable = false)\r\n\r\n\t\t\tif (navigator.mediaDevices.getDisplayMedia) {\r\n\t\t\t\tthis.setState({ screenAvailable: true })\r\n\t\t\t} else {\r\n\t\t\t\tthis.setState({ screenAvailable: false })\r\n\t\t\t}\r\n\r\n\t\t\tif (this.videoAvailable || this.audioAvailable) {\r\n\t\t\t\tnavigator.mediaDevices.getUserMedia({ video: this.videoAvailable, audio: this.audioAvailable })\r\n\t\t\t\t\t.then((stream) => {\r\n\t\t\t\t\t\twindow.localStream = stream\r\n\t\t\t\t\t\tthis.localVideoref.current.srcObject = stream\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then((stream) => {})\r\n\t\t\t\t\t.catch((e) => console.log(e))\r\n\t\t\t}\r\n\t\t} catch(e) { console.log(e) }\r\n\t}\r\n\r\n\tgetMedia = () => {\r\n\t\tthis.setState({\r\n\t\t\tvideo: this.videoAvailable,\r\n\t\t\taudio: this.audioAvailable\r\n\t\t}, () => {\r\n\t\t\tthis.getUserMedia()\r\n\t\t\tthis.connectToSocketServer()\r\n\t\t})\r\n\t}\r\n\r\n\tgetUserMedia = () => {\r\n\t\tif ((this.state.video && this.videoAvailable) || (this.state.audio && this.audioAvailable)) {\r\n\t\t\tnavigator.mediaDevices.getUserMedia({ video: this.state.video, audio: this.state.audio })\r\n\t\t\t\t.then(this.getUserMediaSuccess)\r\n\t\t\t\t.then((stream) => {})\r\n\t\t\t\t.catch((e) => console.log(e))\r\n\t\t} else {\r\n\t\t\ttry {\r\n\t\t\t\tlet tracks = this.localVideoref.current.srcObject.getTracks()\r\n\t\t\t\ttracks.forEach(track => track.stop())\r\n\t\t\t} catch (e) {}\r\n\t\t}\r\n\t}\r\n\r\n\tgetUserMediaSuccess = (stream) => {\r\n\t\ttry {\r\n\t\t\twindow.localStream.getTracks().forEach(track => track.stop())\r\n\t\t} catch(e) { console.log(e) }\r\n\r\n\t\twindow.localStream = stream\r\n\t\tthis.localVideoref.current.srcObject = stream\r\n\r\n\t\tfor (let id in connections) {\r\n\t\t\tif (id === socketId) continue\r\n\r\n\t\t\tconnections[id].addStream(window.localStream)\r\n\r\n\t\t\t// eslint-disable-next-line no-loop-func\r\n\t\t\tconnections[id].createOffer().then((description) => {\r\n\t\t\t\tconnections[id].setLocalDescription(description)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsocket.emit('signal', id, JSON.stringify({ 'sdp': connections[id].localDescription }))\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(e => console.log(e))\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tstream.getTracks().forEach(track => track.onended = () => {\r\n\t\t\tthis.setState({\r\n\t\t\t\tvideo: false,\r\n\t\t\t\taudio: false,\r\n\t\t\t}, () => {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet tracks = this.localVideoref.current.srcObject.getTracks()\r\n\t\t\t\t\ttracks.forEach(track => track.stop())\r\n\t\t\t\t} catch(e) { console.log(e) }\r\n\r\n\t\t\t\tlet blackSilence = (...args) => new MediaStream([this.black(...args), this.silence()])\r\n\t\t\t\twindow.localStream = blackSilence()\r\n\t\t\t\tthis.localVideoref.current.srcObject = window.localStream\r\n\r\n\t\t\t\tfor (let id in connections) {\r\n\t\t\t\t\tconnections[id].addStream(window.localStream)\r\n\r\n\t\t\t\t\t// eslint-disable-next-line no-loop-func\r\n\t\t\t\t\tconnections[id].createOffer().then((description) => {\r\n\t\t\t\t\t\tconnections[id].setLocalDescription(description)\r\n\t\t\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\t\t\tsocket.emit('signal', id, JSON.stringify({ 'sdp': connections[id].localDescription }))\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.catch(e => console.log(e))\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\tgetDislayMedia = () => {\r\n\t\tif (this.state.screen) {\r\n\t\t\tif (navigator.mediaDevices.getDisplayMedia) {\r\n\t\t\t\tnavigator.mediaDevices.getDisplayMedia({ video: true, audio: true })\r\n\t\t\t\t\t.then(this.getDislayMediaSuccess)\r\n\t\t\t\t\t.then((stream) => {})\r\n\t\t\t\t\t.catch((e) => console.log(e))\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetDislayMediaSuccess = (stream) => {\r\n\t\ttry {\r\n\t\t\twindow.localStream.getTracks().forEach(track => track.stop())\r\n\t\t} catch(e) { console.log(e) }\r\n\r\n\t\twindow.localStream = stream\r\n\t\tthis.localVideoref.current.srcObject = stream\r\n\r\n\t\tfor (let id in connections) {\r\n\t\t\tif (id === socketId) continue\r\n\r\n\t\t\tconnections[id].addStream(window.localStream)\r\n\r\n\t\t\t// eslint-disable-next-line no-loop-func\r\n\t\t\tconnections[id].createOffer().then((description) => {\r\n\t\t\t\tconnections[id].setLocalDescription(description)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tsocket.emit('signal', id, JSON.stringify({ 'sdp': connections[id].localDescription }))\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(e => console.log(e))\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tstream.getTracks().forEach(track => track.onended = () => {\r\n\t\t\tthis.setState({\r\n\t\t\t\tscreen: false,\r\n\t\t\t}, () => {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet tracks = this.localVideoref.current.srcObject.getTracks()\r\n\t\t\t\t\ttracks.forEach(track => track.stop())\r\n\t\t\t\t} catch(e) { console.log(e) }\r\n\r\n\t\t\t\tlet blackSilence = (...args) => new MediaStream([this.black(...args), this.silence()])\r\n\t\t\t\twindow.localStream = blackSilence()\r\n\t\t\t\tthis.localVideoref.current.srcObject = window.localStream\r\n\r\n\t\t\t\tthis.getUserMedia()\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\tgotMessageFromServer = (fromId, message) => {\r\n\t\tvar signal = JSON.parse(message)\r\n\r\n\t\tif (fromId !== socketId) {\r\n\t\t\tif (signal.sdp) {\r\n\t\t\t\tconnections[fromId].setRemoteDescription(new RTCSessionDescription(signal.sdp)).then(() => {\r\n\t\t\t\t\tif (signal.sdp.type === 'offer') {\r\n\t\t\t\t\t\tconnections[fromId].createAnswer().then((description) => {\r\n\t\t\t\t\t\t\tconnections[fromId].setLocalDescription(description).then(() => {\r\n\t\t\t\t\t\t\t\tsocket.emit('signal', fromId, JSON.stringify({ 'sdp': connections[fromId].localDescription }))\r\n\t\t\t\t\t\t\t}).catch(e => console.log(e))\r\n\t\t\t\t\t\t}).catch(e => console.log(e))\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(e => console.log(e))\r\n\t\t\t}\r\n\r\n\t\t\tif (signal.ice) {\r\n\t\t\t\tconnections[fromId].addIceCandidate(new RTCIceCandidate(signal.ice)).catch(e => console.log(e))\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tchangeCssVideos = (main) => {\r\n\t\tlet widthMain = main.offsetWidth\r\n\t\tlet minWidth = \"30%\"\r\n\t\tif ((widthMain * 30 / 100) < 300) {\r\n\t\t\tminWidth = \"300px\"\r\n\t\t}\r\n\t\tlet minHeight = \"40%\"\r\n\r\n\t\tlet height = String(100 / elms) + \"%\"\r\n\t\tlet width = \"\"\r\n\t\tif(elms === 0 || elms === 1) {\r\n\t\t\twidth = \"100%\"\r\n\t\t\theight = \"100%\"\r\n\t\t} else if (elms === 2) {\r\n\t\t\twidth = \"45%\"\r\n\t\t\theight = \"100%\"\r\n\t\t} else if (elms === 3 || elms === 4) {\r\n\t\t\twidth = \"35%\"\r\n\t\t\theight = \"50%\"\r\n\t\t} else {\r\n\t\t\twidth = String(100 / elms) + \"%\"\r\n\t\t}\r\n\r\n\t\tlet videos = main.querySelectorAll(\"video\")\r\n\t\tfor (let a = 0; a < videos.length; ++a) {\r\n\t\t\tvideos[a].style.minWidth = minWidth\r\n\t\t\tvideos[a].style.minHeight = minHeight\r\n\t\t\tvideos[a].style.setProperty(\"width\", width)\r\n\t\t\tvideos[a].style.setProperty(\"height\", height)\r\n\t\t}\r\n\r\n\t\treturn {minWidth, minHeight, width, height}\r\n\t}\r\n\r\n\tconnectToSocketServer = () => {\r\n\t\tsocket = io.connect(server_url, { secure: true })\r\n\r\n\t\tsocket.on('signal', this.gotMessageFromServer)\r\n\r\n\t\tsocket.on('connect', () => {\r\n\t\t\tsocket.emit('join-call', window.location.href)\r\n\t\t\tsocketId = socket.id\r\n\r\n\t\t\tsocket.on('chat-message', this.addMessage)\r\n\r\n\t\t\tsocket.on('user-left', (id) => {\r\n\t\t\t\tlet video = document.querySelector(`[data-socket=\"${id}\"]`)\r\n\t\t\t\tif (video !== null) {\r\n\t\t\t\t\telms--\r\n\t\t\t\t\tvideo.parentNode.removeChild(video)\r\n\r\n\t\t\t\t\tlet main = document.getElementById('main')\r\n\t\t\t\t\tthis.changeCssVideos(main)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\tsocket.on('user-joined', (id, clients) => {\r\n\t\t\t\tclients.forEach((socketListId) => {\r\n\t\t\t\t\tconnections[socketListId] = new RTCPeerConnection(peerConnectionConfig)\r\n\t\t\t\t\t// Wait for their ice candidate       \r\n\t\t\t\t\tconnections[socketListId].onicecandidate = function (event) {\r\n\t\t\t\t\t\tif (event.candidate != null) {\r\n\t\t\t\t\t\t\tsocket.emit('signal', socketListId, JSON.stringify({ 'ice': event.candidate }))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Wait for their video stream\r\n\t\t\t\t\tconnections[socketListId].onaddstream = (event) => {\r\n\t\t\t\t\t\t// TODO mute button, full screen button\r\n\t\t\t\t\t\tvar searchVidep = document.querySelector(`[data-socket=\"${socketListId}\"]`)\r\n\t\t\t\t\t\tif (searchVidep !== null) { // if i don't do this check it make an empyt square\r\n\t\t\t\t\t\t\tsearchVidep.srcObject = event.stream\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\telms = clients.length\r\n\t\t\t\t\t\t\tlet main = document.getElementById('main')\r\n\t\t\t\t\t\t\tlet cssMesure = this.changeCssVideos(main)\r\n\r\n\t\t\t\t\t\t\tlet video = document.createElement('video')\r\n\r\n\t\t\t\t\t\t\tlet css = {minWidth: cssMesure.minWidth, minHeight: cssMesure.minHeight, maxHeight: \"100%\", margin: \"10px\",\r\n\t\t\t\t\t\t\t\tborderStyle: \"solid\", borderColor: \"#bdbdbd\", objectFit: \"fill\"}\r\n\t\t\t\t\t\t\tfor(let i in css) video.style[i] = css[i]\r\n\r\n\t\t\t\t\t\t\tvideo.style.setProperty(\"width\", cssMesure.width)\r\n\t\t\t\t\t\t\tvideo.style.setProperty(\"height\", cssMesure.height)\r\n\t\t\t\t\t\t\tvideo.setAttribute('data-socket', socketListId)\r\n\t\t\t\t\t\t\tvideo.srcObject = event.stream\r\n\t\t\t\t\t\t\tvideo.autoplay = true\r\n\t\t\t\t\t\t\tvideo.playsinline = true\r\n\r\n\t\t\t\t\t\t\tmain.appendChild(video)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Add the local video stream\r\n\t\t\t\t\tif (window.localStream !== undefined && window.localStream !== null) {\r\n\t\t\t\t\t\tconnections[socketListId].addStream(window.localStream)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet blackSilence = (...args) => new MediaStream([this.black(...args), this.silence()])\r\n\t\t\t\t\t\twindow.localStream = blackSilence()\r\n\t\t\t\t\t\tconnections[socketListId].addStream(window.localStream)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\r\n\t\t\t\tif (id === socketId) {\r\n\t\t\t\t\tfor (let id2 in connections) {\r\n\t\t\t\t\t\tif (id2 === socketId) continue\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tconnections[id2].addStream(window.localStream)\r\n\t\t\t\t\t\t} catch(e) {}\r\n\t\t\t\r\n\t\t\t\t\t\t// eslint-disable-next-line no-loop-func\r\n\t\t\t\t\t\tconnections[id2].createOffer().then((description) => {\r\n\t\t\t\t\t\t\tconnections[id2].setLocalDescription(description)\r\n\t\t\t\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\t\t\t\tsocket.emit('signal', id2, JSON.stringify({ 'sdp': connections[id2].localDescription }))\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.catch(e => console.log(e))\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\tsilence = () => {\r\n\t\tlet ctx = new AudioContext()\r\n\t\tlet oscillator = ctx.createOscillator()\r\n\t\tlet dst = oscillator.connect(ctx.createMediaStreamDestination())\r\n\t\toscillator.start()\r\n\t\tctx.resume()\r\n\t\treturn Object.assign(dst.stream.getAudioTracks()[0], { enabled: false })\r\n\t}\r\n\tblack = ({ width = 640, height = 480 } = {}) => {\r\n\t\tlet canvas = Object.assign(document.createElement(\"canvas\"), { width, height })\r\n\t\tcanvas.getContext('2d').fillRect(0, 0, width, height)\r\n\t\tlet stream = canvas.captureStream()\r\n\t\treturn Object.assign(stream.getVideoTracks()[0], { enabled: false })\r\n\t}\r\n\r\n\thandleVideo = () => this.setState({ video: !this.state.video }, () => this.getUserMedia())\r\n\thandleAudio = () => this.setState({ audio: !this.state.audio }, () => this.getUserMedia())\r\n\thandleScreen = () => this.setState({ screen: !this.state.screen }, () => this.getDislayMedia())\r\n\r\n\thandleEndCall = () => {\r\n\t\ttry {\r\n\t\t\tlet tracks = this.localVideoref.current.srcObject.getTracks()\r\n\t\t\ttracks.forEach(track => track.stop())\r\n\t\t} catch (e) {}\r\n\t\twindow.location.href = \"/\"\r\n\t}\r\n\r\n\topenChat = () => this.setState({ showModal: true, newmessages: 0 })\r\n\tcloseChat = () => this.setState({ showModal: false })\r\n\thandleMessage = (e) => this.setState({ message: e.target.value })\r\n\r\n\taddMessage = (data, sender, socketIdSender) => {\r\n\t\tthis.setState(prevState => ({\r\n\t\t\tmessages: [...prevState.messages, { \"sender\": sender, \"data\": data }],\r\n\t\t}))\r\n\t\tif (socketIdSender !== socketId) {\r\n\t\t\tthis.setState({ newmessages: this.state.newmessages + 1 })\r\n\t\t}\r\n\t}\r\n\r\n\thandleUsername = (e) => this.setState({ username: e.target.value })\r\n\r\n\tsendMessage = () => {\r\n\t\tsocket.emit('chat-message', this.state.message, this.state.username)\r\n\t\tthis.setState({ message: \"\", sender: this.state.username })\r\n\t}\r\n\r\n\tcopyUrl = () => {\r\n\t\tlet text = window.location.href\r\n\t\tif (!navigator.clipboard) {\r\n\t\t\tlet textArea = document.createElement(\"textarea\")\r\n\t\t\ttextArea.value = text\r\n\t\t\tdocument.body.appendChild(textArea)\r\n\t\t\ttextArea.focus()\r\n\t\t\ttextArea.select()\r\n\t\t\ttry {\r\n\t\t\t\tdocument.execCommand('copy')\r\n\t\t\t\tmessage.success(\"Link copied to clipboard!\")\r\n\t\t\t} catch (err) {\r\n\t\t\t\tmessage.error(\"Failed to copy\")\r\n\t\t\t}\r\n\t\t\tdocument.body.removeChild(textArea)\r\n\t\t\treturn\r\n\t\t}\r\n\t\tnavigator.clipboard.writeText(text).then(function () {\r\n\t\t\tmessage.success(\"Link copied to clipboard!\")\r\n\t\t}, () => {\r\n\t\t\tmessage.error(\"Failed to copy\")\r\n\t\t})\r\n\t}\r\n\r\n\tconnect = () => this.setState({ askForUsername: false }, () => this.getMedia())\r\n\r\n\tisChrome = function () {\r\n\t\tlet userAgent = (navigator && (navigator.userAgent || '')).toLowerCase()\r\n\t\tlet vendor = (navigator && (navigator.vendor || '')).toLowerCase()\r\n\t\tlet matchChrome = /google inc/.test(vendor) ? userAgent.match(/(?:chrome|crios)\\/(\\d+)/) : null\r\n\t\t// let matchFirefox = userAgent.match(/(?:firefox|fxios)\\/(\\d+)/)\r\n\t\t// return matchChrome !== null || matchFirefox !== null\r\n\t\treturn matchChrome !== null\r\n\t}\r\n\r\n\trender() {\r\n\t\tif(this.isChrome() === false){\r\n\t\t\treturn (\r\n\t\t\t\t<div style={{background: \"white\", width: \"30%\", height: \"auto\", padding: \"20px\", minWidth: \"400px\",\r\n\t\t\t\t\t\ttextAlign: \"center\", margin: \"auto\", marginTop: \"50px\", justifyContent: \"center\"}}>\r\n\t\t\t\t\t<h1>Sorry, this works only with Google Chrome</h1>\r\n\t\t\t\t</div>\r\n\t\t\t)\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<div>\r\n\t\t\t\t{this.state.askForUsername === true ?\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<div style={{background: \"white\", width: \"30%\", height: \"auto\", padding: \"20px\", minWidth: \"400px\",\r\n\t\t\t\t\t\t\t\ttextAlign: \"center\", margin: \"auto\", marginTop: \"50px\", justifyContent: \"center\"}}>\r\n\t\t\t\t\t\t\t<p style={{ margin: 0, fontWeight: \"bold\", paddingRight: \"50px\" }}>Set your username</p>\r\n\t\t\t\t\t\t\t<Input placeholder=\"Username\" value={this.state.username} onChange={e => this.handleUsername(e)} />\r\n\t\t\t\t\t\t\t<Button variant=\"contained\" color=\"primary\" onClick={this.connect} style={{ margin: \"20px\" }}>Connect</Button>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div style={{ justifyContent: \"center\", textAlign: \"center\", paddingTop: \"40px\", alignItems: 'center'}}>\r\n\t\t\t\t\t\t\t<video id=\"my-video\" ref={this.localVideoref} autoPlay muted style={{\r\n\t\t\t\t\t\t\t\tborderStyle: \"solid\",borderColor: \"#bdbdbd\",objectFit: \"fill\",width: \"30%\",height: \"30%\"}}></video>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t:\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<div className=\"btn-down\" style={{ backgroundColor: \"whitesmoke\", color: \"whitesmoke\", textAlign: \"center\" }}>\r\n\t\t\t\t\t\t\t<IconButton style={{ color: \"#424242\" }} onClick={this.handleVideo}>\r\n\t\t\t\t\t\t\t\t{(this.state.video === true) ? <VideocamIcon /> : <VideocamOffIcon />}\r\n\t\t\t\t\t\t\t</IconButton>\r\n\r\n\t\t\t\t\t\t\t<IconButton style={{ color: \"#f44336\" }} onClick={this.handleEndCall}>\r\n\t\t\t\t\t\t\t\t<CallEndIcon />\r\n\t\t\t\t\t\t\t</IconButton>\r\n\r\n\t\t\t\t\t\t\t<IconButton style={{ color: \"#424242\" }} onClick={this.handleAudio}>\r\n\t\t\t\t\t\t\t\t{this.state.audio === true ? <MicIcon /> : <MicOffIcon />}\r\n\t\t\t\t\t\t\t</IconButton>\r\n\r\n\t\t\t\t\t\t\t{this.state.screenAvailable === true ?\r\n\t\t\t\t\t\t\t\t<IconButton style={{ color: \"#424242\" }} onClick={this.handleScreen}>\r\n\t\t\t\t\t\t\t\t\t{this.state.screen === true ? <ScreenShareIcon /> : <StopScreenShareIcon />}\r\n\t\t\t\t\t\t\t\t</IconButton>\r\n\t\t\t\t\t\t\t\t: null}\r\n\r\n\t\t\t\t\t\t\t<Badge badgeContent={this.state.newmessages} max={999} color=\"secondary\" onClick={this.openChat}>\r\n\t\t\t\t\t\t\t\t<IconButton style={{ color: \"#424242\" }} onClick={this.openChat}>\r\n\t\t\t\t\t\t\t\t\t<ChatIcon />\r\n\t\t\t\t\t\t\t\t</IconButton>\r\n\t\t\t\t\t\t\t</Badge>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<Modal show={this.state.showModal} onHide={this.closeChat} style={{ zIndex: \"999999\" }}>\r\n\t\t\t\t\t\t\t<Modal.Header closeButton>\r\n\t\t\t\t\t\t\t\t<Modal.Title>Chat Room</Modal.Title>\r\n\t\t\t\t\t\t\t</Modal.Header>\r\n\t\t\t\t\t\t\t<Modal.Body style={{ overflow: \"auto\", overflowY: \"auto\", height: \"400px\", textAlign: \"left\" }} >\r\n\t\t\t\t\t\t\t\t{this.state.messages.length > 0 ? this.state.messages.map((item, index) => (\r\n\t\t\t\t\t\t\t\t\t<div key={index} style={{textAlign: \"left\"}}>\r\n\t\t\t\t\t\t\t\t\t\t<p style={{ wordBreak: \"break-all\" }}><b>{item.sender}</b>: {item.data}</p>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t)) : <p>No message yet</p>}\r\n\t\t\t\t\t\t\t</Modal.Body>\r\n\t\t\t\t\t\t\t<Modal.Footer className=\"div-send-msg\">\r\n\t\t\t\t\t\t\t\t<Input placeholder=\"Message\" value={this.state.message} onChange={e => this.handleMessage(e)} />\r\n\t\t\t\t\t\t\t\t<Button variant=\"contained\" color=\"primary\" onClick={this.sendMessage}>Send</Button>\r\n\t\t\t\t\t\t\t</Modal.Footer>\r\n\t\t\t\t\t\t</Modal>\r\n\r\n\t\t\t\t\t\t<div className=\"container\">\r\n\t\t\t\t\t\t\t<div style={{ paddingTop: \"20px\" }}>\r\n\t\t\t\t\t\t\t\t<Input value={window.location.href} disable=\"true\"></Input>\r\n\t\t\t\t\t\t\t\t<Button style={{backgroundColor: \"#3f51b5\",color: \"whitesmoke\",marginLeft: \"20px\",\r\n\t\t\t\t\t\t\t\t\tmarginTop: \"10px\",width: \"120px\",fontSize: \"10px\"\r\n\t\t\t\t\t\t\t\t}} onClick={this.copyUrl}>Copy invite link</Button>\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<Row id=\"main\" className=\"flex-container\" style={{ margin: 0, padding: 0 }}>\r\n\t\t\t\t\t\t\t\t<video id=\"my-video\" ref={this.localVideoref} autoPlay muted style={{\r\n\t\t\t\t\t\t\t\t\tborderStyle: \"solid\",borderColor: \"#bdbdbd\",margin: \"10px\",objectFit: \"fill\",\r\n\t\t\t\t\t\t\t\t\twidth: \"50%\",height: \"50%\"}}>\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t</video>\r\n\t\t\t\t\t\t\t</Row>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default Video;"]},"metadata":{},"sourceType":"module"}